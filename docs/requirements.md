# 系统需求文档

## 1. 项目概述

本项目是一个功能完整的基础应用脚手架，提供用户认证、角色管理、菜单配置等核心功能，支持模块化开发和扩展。

## 2. 技术栈

### 前端
- Vue 3 + Vite + TypeScript
- Element Plus UI 库
- Pinia 状态管理
- Vue Router 路由
- Axios HTTP 客户端

### 后端
- Node.js + Express
- MongoDB 数据库
- JWT 认证
- bcryptjs 密码加密
- Nodemailer 邮件发送

## 3. 核心功能

### 3.1 用户认证系统
- **登录功能**：支持邮箱或用户名登录，包含"记住我"选项
- **注册功能**：支持邮箱注册，包含邮箱验证流程
- **密码管理**：支持修改密码、忘记密码功能
- **邮箱验证**：使用 QQ 邮箱 SMTP 发送验证邮件
- **管理员登录**：独立的管理员登录页面，与普通用户系统隔离

### 3.2 角色管理
- **角色类型**：普通用户、管理员
- **权限控制**：基于角色的菜单显示和权限控制
- **管理员生成**：第一个被验证的用户自动成为管理员

### 3.3 菜单系统
- **菜单配置**：支持三级菜单配置（未登录用户、普通用户、管理员）
- **菜单顺序**：支持通过 order 字段控制菜单显示顺序
- **菜单权限**：基于角色的菜单权限控制

### 3.4 核心模块
- **首页**：系统主页面
- **公告管理**：公告列表和发布功能
- **消息中心**：消息列表和消息设置
- **个人中心**：个人信息管理和密码修改
- **系统管理**：用户管理、未验证用户管理、菜单配置（仅管理员可见）

## 4. 系统配置

### 4.1 应用配置
- **系统名称**：可通过配置文件修改
- **系统版本**：可通过配置文件管理
- **系统描述**：可通过配置文件设置

### 4.2 菜单配置
- **配置文件**：`client/src/config/menu.ts`
- **配置分类**：
  - 未登录用户菜单
  - 普通用户菜单
  - 管理员菜单
- **菜单结构**：支持一级和二级菜单
- **菜单属性**：path、label、icon、order、children、roles

### 4.3 邮箱配置
- **SMTP 服务**：QQ 邮箱 SMTP
- **配置文件**：环境变量配置

## 5. 系统流程

### 5.1 注册流程
1. 用户填写注册信息（用户名、邮箱、密码）
2. 系统验证信息合法性（用户名长度、邮箱格式等）
3. 系统发送验证邮件到用户邮箱
4. 用户点击邮件中的验证链接
5. 系统验证链接有效性，激活用户账号
6. 第一个被验证的用户自动成为管理员

### 5.2 登录流程
1. 用户输入登录凭证（邮箱或用户名）和密码
2. 系统验证凭证和密码
3. 系统生成 JWT 令牌
4. 根据"记住我"选项选择存储方式（localStorage 或 sessionStorage）
5. 跳转到相应的系统页面（普通用户系统或管理员系统）

### 5.3 退出流程
1. 用户点击退出登录按钮
2. 系统清除登录状态和存储的令牌
3. 根据当前所在系统跳转到相应的登录页面

## 6. 界面设计

### 6.1 布局
- **左侧导航栏**：显示系统菜单
- **顶部导航栏**：显示面包屑、消息通知、用户头像和退出按钮
- **主内容区**：显示当前页面内容

### 6.2 页面
- **登录页面**：普通用户登录界面
- **管理员登录页面**：管理员专用登录界面
- **注册页面**：用户注册界面
- **邮箱验证页面**：邮箱验证状态显示页面
- **首页**：系统主页面
- **公告管理页面**：公告列表和发布界面
- **消息中心页面**：消息列表和设置界面
- **个人中心页面**：个人信息和密码修改界面
- **系统管理页面**：用户管理、未验证用户管理、菜单配置界面

## 7. 安全措施

### 7.1 认证安全
- **密码加密**：使用 bcryptjs 加密存储密码
- **JWT 令牌**：使用 JWT 进行身份验证
- **令牌过期**：令牌设置有效期，过期后需要重新登录

### 7.2 输入验证
- **前端验证**：表单验证、输入格式检查
- **后端验证**：服务器端验证、防止注入攻击

### 7.3 权限控制
- **基于角色的访问控制**：不同角色看到不同的菜单和功能
- **API 权限验证**：敏感 API 需要验证用户权限

## 8. 部署与维护

### 8.1 环境配置
- **前端环境**：Node.js 16+、npm 或 yarn
- **后端环境**：Node.js 16+、MongoDB 4.0+
- **环境变量**：需要配置 JWT 密钥、数据库连接、邮箱 SMTP 配置

### 8.2 构建与部署
- **前端构建**：`npm run build`
- **后端构建**：`npm run build`
- **部署方式**：可部署到云服务器或容器平台

### 8.3 维护
- **日志管理**：系统运行日志
- **错误处理**：统一的错误处理机制
- **数据备份**：定期备份数据库

## 9. 开发规范

### 9.1 代码规范
- **前端**：TypeScript 类型定义、ESLint 代码检查
- **后端**：TypeScript 类型定义、ESLint 代码检查

### 9.2 目录结构
- **前端**：模块化结构，按功能划分模块
- **后端**：MVC 架构，分离控制器、模型、路由

### 9.3 版本控制
- **Git**：使用 Git 进行版本控制
- **分支管理**：master、develop、feature 分支

## 10. 未来扩展

### 10.1 功能扩展
- **多语言支持**：国际化
- **主题切换**：深色/浅色模式
- **第三方登录**：微信、QQ、GitHub 登录
- **API 文档**：Swagger 文档

### 10.2 性能优化
- **前端优化**：代码分割、懒加载
- **后端优化**：缓存、数据库索引
- **部署优化**：CDN、负载均衡

## 11. 需求变更记录

| 日期 | 变更内容 | 变更原因 | 影响范围 |
|------|----------|----------|----------|
| 2026-02-25 | 支持邮箱或用户名登录 | 提高用户体验 | 登录组件、后端认证 |
| 2026-02-25 | 移除普通登录页面中的管理员登录链接 | 系统隔离 | 登录页面 |
| 2026-02-25 | 管理员登录后退出到管理员登录界面 | 系统隔离 | 退出登录逻辑 |
| 2026-02-25 | 第一个被验证的用户成为管理员 | 权限管理 | 邮箱验证逻辑 |
| 2026-02-25 | 注册时的错误处理 | 提高用户体验 | 注册逻辑 |
| 2026-02-25 | 菜单顺序配置 | 提高用户体验 | 菜单配置 |
| 2026-02-25 | 系统名称可配置 | 灵活性 | 应用配置 |

## 12. 结论

本系统是一个功能完整、安全可靠的基础应用脚手架，提供了用户认证、角色管理、菜单配置等核心功能，支持模块化开发和扩展。系统采用现代化的技术栈，具有良好的可维护性和可扩展性，适合作为各种Web应用的基础框架。